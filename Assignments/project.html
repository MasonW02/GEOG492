<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Route to San Diego - Mapbox GL JS v3 Compatible</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoibWFzb253MDIiLCJhIjoiY205OTEzcXBpMDk0dTJpcHhseDl4dWNjOSJ9.tSqKSLEVU1A0vQ8kKHhxkw';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-121.0, 39.0],
    zoom: 5
  });

  const origin = [-123.0707, 44.0435]; // McArthur Court, Eugene
  const destination = [-117.1755, 32.8210]; // California Suites Hotel, San Diego

  // Add static markers
  new mapboxgl.Marker({ color: 'green' })
    .setLngLat(origin)
    .setPopup(new mapboxgl.Popup().setText("Start: McArthur Court"))
    .addTo(map);

  new mapboxgl.Marker({ color: 'red' })
    .setLngLat(destination)
    .setPopup(new mapboxgl.Popup().setText("End: California Suites Hotel"))
    .addTo(map);

  async function getRoute() {
    const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${origin[0]},${origin[1]};${destination[0]},${destination[1]}?geometries=geojson&overview=full&access_token=${mapboxgl.accessToken}`;

    const response = await fetch(url);
    const json = await response.json();
    const data = json.routes[0];

    if (!data || !data.geometry) {
      console.error("No route found.");
      return;
    }

    const route = data.geometry;

    map.addSource('route', {
      type: 'geojson',
      data: {
        type: 'Feature',
        geometry: route
      }
    });

    map.addLayer({
      id: 'route',
      type: 'line',
      source: 'route',
      layout: {
        'line-join': 'round',
        'line-cap': 'round'
      },
      paint: {
        'line-color': '#0074D9',
        'line-width': 4
      }
    });

    // Fit the map to the route
    const bounds = new mapboxgl.LngLatBounds();
    route.coordinates.forEach(coord => bounds.extend(coord));
    map.fitBounds(bounds, { padding: 50 });
  }

  map.on('load', getRoute);
</script>
</body>
</html>
