<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Oregon Ego Tournament Travel Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; }
    #map { position: absolute; top: 40px; bottom: 0; width: 100%; }
    #buttons-container {
  position: absolute;
  top: 0;
  left: 0;
  display: flex;
  align-items: center;
  background: #fff;
  padding: 5px 10px;
  z-index: 1;
  box-shadow: 0 1px 5px rgba(0,0,0,0.3);
  gap: 10px;
}

#buttons {
  display: flex;
  gap: 10px;
}

#blurb {
  font-size: 14px;
  color: #0c6d10;
  white-space: nowrap;
}

button {
  cursor: pointer;
  padding: 6px 12px;
  font-size: 14px;
  border: none;
  background: #0e8e13;
  color: white;
  border-radius: 4px;
}

button:hover {
  background: #0c6d10;
}
    
.popup-summary {
  position: absolute;
  top: 50px;
  right: 20px;
  background: rgba(255,255,255,0.9);
  padding: 10px;
  border-radius: 6px;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
  z-index: 2;
  font-size: 14px;
}

 .descriptionPanel {
    position: absolute;
    bottom: 65px;
    left: 20px;
    z-index: 2;
    width: 500px;
    height: 65px;
    background: rgba(80, 80, 80, .80);
    transition: width 2s, height 2s;
    overflow: hidden;
    border-radius: 7px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    }

   .layerDescription {
     color: white;
     padding-left: 10px;
   }

  p {
     color: white;
   }

  h4 {
   color: white;
 }
    
  </style>
</head>
<body>
  
<div id="buttons-container">
  <div id="blurb">Oregon Ego Ultimate Frisbee 2025 Regular Season Travel Tournaments:</div>
  <div id="buttons">
    <button onclick="loadSanDiegoTrip()">President's Day Invitational</button>
    <button onclick="loadKnoxvilleTrip()">Smoky Mountain Invitational</button>
    <button onclick="loadWilmingtonTrip()">Easterns</button>
  </div>
</div>

<div id="map"></div>
<div id="summary" class="popup-summary" style="display: none;"></div>
<!-- map description panel -->
<div class="descriptionPanel" id="descriptionPanel" style="height: 500px;">
<div id="panelToggle" onclick="toggleDescriptionPanel()" style="text-align: center; cursor: pointer; color: white;">
  ▼
</div>
 <h4 style="margin-left: 10px;">Tournament Summary</h4>
 <p id="descriptionText" style="margin-left: 10px; margin-right: 10px;">
   Temporary Filler Text
 </p>
</div>


<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoibWFzb253MDIiLCJhIjoiY205OTEzcXBpMDk0dTJpcHhseDl4dWNjOSJ9.tSqKSLEVU1A0vQ8kKHhxkw';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-121, 39],
    zoom: 5
  });
  map.dragRotate.disable();

  const markers = [];
  let routeIds = [];
  let totalDrivingMiles = 0;
  let totalFlightMiles = 0;

  function clearMap() {
    for (const id of routeIds) {
      if (map.getLayer(id)) map.removeLayer(id);
      if (map.getSource(id)) map.removeSource(id);
    }
    routeIds = [];

    for (const marker of markers) {
      marker.remove();
    }
    markers.length = 0;

    totalDrivingMiles = 0;
    totalFlightMiles = 0;
    document.getElementById('summary').style.display = 'none';
  }

  function addMarker(coords, label, color) {
    const marker = new mapboxgl.Marker({ color })
      .setLngLat(coords)
      .setPopup(new mapboxgl.Popup().setText(label))
      .addTo(map);
    markers.push(marker);
  }

  async function addDrivingRoute(start, end, id) {
    const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${start[0]},${start[1]};${end[0]},${end[1]}?geometries=geojson&access_token=${mapboxgl.accessToken}`;
    const res = await fetch(url);
    const json = await res.json();
    const route = json.routes[0].geometry;
    const distance = json.routes[0].distance; // in meters
    totalDrivingMiles += distance / 1609.34;

    map.addSource(id, {
      type: 'geojson',
      data: {
        type: 'Feature',
        geometry: route
      }
    });

    map.addLayer({
      id,
      type: 'line',
      source: id,
      layout: { 'line-cap': 'round', 'line-join': 'round' },
      paint: {
        'line-color': '#0074D9',
        'line-width': 4
      }
    });

    routeIds.push(id);
    return route.coordinates;
  }

  function haversineDistance(coord1, coord2) {
    const toRad = d => d * Math.PI / 180;
    const R = 6371; // Earth radius in km
    const dLat = toRad(coord2[1] - coord1[1]);
    const dLon = toRad(coord2[0] - coord1[0]);
    const lat1 = toRad(coord1[1]);
    const lat2 = toRad(coord2[1]);

    const a = Math.sin(dLat/2) ** 2 + Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon/2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c * 0.621371; // convert to miles
  }

  function addFlightArc(start, end, id) {
    const arc = {
      type: 'Feature',
      geometry: {
        type: 'LineString',
        coordinates: interpolateArc(start, end)
      }
    };

    totalFlightMiles += haversineDistance(start, end);

    map.addSource(id, {
      type: 'geojson',
      data: arc
    });

    map.addLayer({
      id,
      type: 'line',
      source: id,
      layout: {},
      paint: {
        'line-color': '#FF4136',
        'line-width': 2,
        'line-dasharray': [2, 4]
      }
    });

    routeIds.push(id);
    return arc.geometry.coordinates;
  }

  function interpolateArc(start, end) {
    const steps = 50;
    const arc = [];
    for (let i = 0; i <= steps; i++) {
      const lon = start[0] + (end[0] - start[0]) * (i / steps);
      const lat = start[1] + (end[1] - start[1]) * (i / steps) + Math.sin((Math.PI * i) / steps) * 3;
      arc.push([lon, lat]);
    }
    return arc;
  }

  function fitRoute(coordinates) {
    const bounds = new mapboxgl.LngLatBounds();
    coordinates.forEach(coord => bounds.extend(coord));
    map.fitBounds(bounds, { padding: 60 });
  }

  function showSummary() {
    const el = document.getElementById('summary');
    el.innerHTML = `Total Driving Distance: ${totalDrivingMiles.toFixed(1)} mi<br>Total Flying Distance: ${totalFlightMiles.toFixed(1)} mi`;
    el.style.display = 'block';
  }

function updateDescription(html) {
  document.getElementById('descriptionPanel').querySelector('p').innerHTML = html;
}

let panelOpen = true;

function toggleDescriptionPanel() {
  const panel = document.getElementById('descriptionPanel');
  const toggle = document.getElementById('panelToggle');
  const descriptionText = panel.querySelector('p');

  if (panelOpen) {
    panel.style.height = '65px';  // enough for heading and arrow
    toggle.textContent = '▲';
    descriptionText.style.display = 'none';
  } else {
    panel.style.height = '500px';
    toggle.textContent = '▼';
    descriptionText.style.display = 'block';
  }

  panelOpen = !panelOpen;
}

  async function loadSanDiegoTrip() {
    clearMap();
    const start = [-123.0707, 44.0435];
    const end = [-117.1755, 32.8210];
    addMarker(start, "Start: McArthur Court", 'green');
    addMarker(end, "End: California Suites Hotel", 'red');

    const coords = await addDrivingRoute(start, end, 'sd-route');
    fitRoute(coords);
    showSummary();
    updateDescription('<p>Presidents Day Invitational in San Diego, CA. This mid-Febuary tournament kicks off the season and regularly features the top west coast programs. Oregon Ego got off to a hot start to their season at this tournament, winning all their games to go 8-0 on the weekend, including key victories over rivals Colarado and Oregon State in the semifinals and finals, respectively. View the full tournament results <a href="https://play.usaultimate.org/events/Presidents-Day-Invite-2025/schedule/Men/CollegeMen/" target="_blank" style="color: #aad8ff; text-decoration: underline;">here</a><figure><img src="https://cdn.ultiworld.com/wordpress/wp-content/uploads/2025/02/pdi_wcb_65282_20250217_134257-ZF-7571-76694-1-001.jpg" alt="prez_day_img" width="400" height="270"><figcaption>Ego Captain Mica Class is guarded by OSU captain Ben Thoennes during the final</figcaption></figure></p>');
    if (!panelOpen) toggleDescriptionPanel();
    if (!state.panelOpen) panelSelect();
  } 
  async function loadKnoxvilleTrip() {
    clearMap();
    const eugene = [-123.0707, 44.0435];
    const pdx = [-122.5951, 45.5887];
    const dfw = [-97.0403, 32.8998];
    const tys = [-83.9940, 35.8101];
    const hotel = [-84.0672, 35.9244];

    addMarker(eugene, "Start: McArthur Court", 'green');
    addMarker(pdx, "Portland International Airport", 'orange');
    addMarker(dfw, "Dallas Fort Worth Airport", 'orange');
    addMarker(tys, "McGhee Tyson Airport", 'orange');
    addMarker(hotel, "End: Holiday Inn Knoxville West", 'red');

    const car1 = await addDrivingRoute(eugene, pdx, 'drive1');
    const flight1 = addFlightArc(pdx, dfw, 'flight1');
    const flight2 = addFlightArc(dfw, tys, 'flight2');
    const car2 = await addDrivingRoute(tys, hotel, 'drive2');

    fitRoute([...car1, ...flight1, ...flight2, ...car2]);
    showSummary();
    updateDescription('<p>Smoky Mountain Invitational in Knoxville, TN. A key mid-season tournament, it featured many of the top teams in the country this year and would present some adveristy for Ego, as they would drop games to 7th seed North Carolina in pool play and 1st seed Carleton in quarterfinals. Not to leave empty-handed, they would rebound to beat rivals Oregon State in the final game to secure fifth place and go 5-2 on the weekend. View the full tournament results <a href="https://play.usaultimate.org/events/Smoky-Mountain-Invite-2025/schedule/Men/CollegeMen/" target="_blank" style="color: #aad8ff; text-decoration: underline;">here</a><figure><img src="https://github.com/MasonW02/GEOG492/blob/main/Assignments/project_images/badarcus.png?raw=true" alt="smi_img" width="400" height="250"><figcaption>Marcus Beidler lays out for the disc at SMI</figcaption></figure></p>');
    if (!panelOpen) toggleDescriptionPanel();
    if (!state.panelOpen) panelSelect();
  }

  async function loadWilmingtonTrip() {
    clearMap();
    const eugene = [-123.0707, 44.0435];
    const pdx = [-122.5951, 45.5887];
    const den = [-104.6737, 39.8561];
    const rdu = [-78.7875, 35.8801];
    const hotel = [-77.8646, 34.2413];

    addMarker(eugene, "Start: McArthur Court", 'green');
    addMarker(pdx, "Portland International Airport", 'orange');
    addMarker(den, "Denver International Airport", 'orange');
    addMarker(rdu, "Raleigh-Durham Airport", 'orange');
    addMarker(hotel, "End: Tru by Hilton Wilmington", 'red');

    const car1 = await addDrivingRoute(eugene, pdx, 'wilm-drive1');
    const flight1 = addFlightArc(pdx, den, 'wilm-flight1');
    const flight2 = addFlightArc(den, rdu, 'wilm-flight2');
    const car2 = await addDrivingRoute(rdu, hotel, 'wilm-drive2');

    fitRoute([...car1, ...flight1, ...flight2, ...car2]);
    showSummary();
    updateDescription('<p>Easterns in Wilmington, NC. This end-of-season event features the strongest teams nationwide and serves as a key test before Nationals. Entering as the 5th seed, Ego would go 3-1 in pool play, dropping a close game to 4th seeded Colorado. The team would respond with a resounding quarterfinals victory over 3rd seeded Carleton, but would go on to lose the semifinal game against Massachusetts. Not deterred, Oregon Ego proceeded to beat 1st seeded North Carolina in the final game of the weekend to secure 3rd place and a 5-2 record. View the full tournament results <a href="https://play.usaultimate.org/events/Easterns-2025/schedule/Men/CollegeMen/division_1/" target="_blank" style="color: #aad8ff; text-decoration: underline;">here</a><figure><img src="https://github.com/MasonW02/GEOG492/blob/main/Assignments/project_images/boon.jpg?raw=true" alt="prez_day_img" width="300" height="400"><figcaption>Oregon player Julian Saunt rises for the disc against Georgia at Easterns</figcaption></figure></p>');
    if (!panelOpen) toggleDescriptionPanel();
    if (!state.panelOpen) panelSelect();
  }

  map.on('load', loadSanDiegoTrip);
  
</script>
</body>
</html>
